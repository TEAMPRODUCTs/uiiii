define(["libs","c","CommonStore","PayStore","PayModel","PayParentView","selectpayment_html","cUtility","cWidgetFactory","paymentPipe","cUIInputClear","cUtilityCrypt","cUICore","Business","Util","PayValidate","RuleManager","Bankmap","bankincrement"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){var b=r.PaymentWayStore.getInstance(),w=r.OrderDetailStore.getInstance(),E=r.ExtendInfoStore.getInstance(),S=r.SelectBankStore.getInstance(),x=a.create("Guider"),T=r.BankListStore.getInstance(),N=r.oldCardsStore.getInstance(),C=[],k="",L="",A=0,O=s.extend({pageid:"232002",hpageid:"232002",noticeFlag:"pay",alertArr:[],tpl:o,payMethFlag:1,onHide:function(){this.hideLoading(),this.alertArr.forEach(function(e,t){e&&e.hide&&e.hide()}),p&&p.alertArr.forEach(function(e,t){e&&e.hide&&e.hide()})},onCreate:function(){p.jumpDetailFn.call(this),this.render(),this.updatePage()},onShow:function(){this.showTitleByBu()},onLoad:function(e){var t=this;try{t.turning()}catch(n){}},render:function(){this.$el.html(this.tpl),this.els={used_list:this.$el.find("#c_payment_selectpayment_used_list"),list_bank:this.$el.find("#c_payment_selectpay_bank_lists"),cardtop:this.$el.find("#c_payment_selectpay_cardtop"),used_list_bank_tpl:this.$el.find("#c_payment_selectpay_list_bank_tpl"),c_payment_paymentnote:this.$el.find("#c_payment_paymentnote"),cardlist_arrow:this.$el.find("#c_payment_selectpay_arrow"),unionpay_box:this.$el.find("#c_payment_selectpay_paywaylist_ul"),contentText:this.$el.find(".valign")},this.templateBankList=_.template(this.els.used_list_bank_tpl.html())},events:{"click .c_payment_selectpay_bankitem":"chosebank"},chosebank:function(e){var t=$(e.currentTarget),n=t.attr("banksn");C[n].isnewcard=!1,S.set(C[n]),b.setAttr("finalPayWay",-1),this.goIndex()},setHeaderView:function(e){var t=this,n=0;t.headerview.set({title:e||"选择支付方式",back:!0,view:t,events:{returnHandler:function(){t.goIndex()}}}),t.headerview.show()},goIndex:function(){var e=w.getAttr("indexurl");this.back(e)},updatePage:function(){var e=this,t=w.get()||{},n=b.get()||{},r=E&&E.get()||{},i=r.useEType,s=0,o=N.get()||[],u=n.paytype;u&&u&2&&(s=1);if(s){for(var a=0,f=o.length;a<f;a++){var l=o[a];l.status&!0&&C.push(l)}if(C.length>0){r.isPayRestrict&&e.els.c_payment_paymentnote.show();var c=this.templateBankList({cardlist:C});this.els.list_bank.html(c)}else e.els.used_list.hide()}else e.els.used_list.hide();p.unionPayCollection.call(this,this.els.unionpay_box)},showTitleByBu:function(){var e=E,t=e&&e.get()&&e.get().useEType;t?t=="1"?(this.setHeaderView(),this.noticeFlag="pay"):t=="2"&&(this.setHeaderView("选择担保方式"),this.noticeFlag="ensure"):this.setHeaderView()},getCardtype:function(e){var t={1:"信用卡",2:"信用卡",3:"储蓄卡"};return t[e]},goBack:function(e){var t=this,e=w.getAttr("indexurl");t.back(e)},get_bankicon:function(e){var n=this;T&&T.get&&!T.get()&&y.intBankCrement();try{var r=T.get().origindatas||{},i="",s=["","CCD","CCY","DC"];for(var o=0;o<r.length;o++){i=_.find(r[o].subDatas,function(t){return t.itemName==s[e.category]});if(e.typeid==Number(i.itembCode))return g.getBankClass(r[o])||"bank_index"}}catch(a){T.remove();var f=new t.ui.Alert({title:"提示信息",message:"系统异常，请重新提交订单(505)",buttons:[{text:"确定",click:function(){var e=w.getAttr("from");u.isInApp()?p.jump2App(e):window.location.href=e},type:t.ui.Alert.STYLE_CONFIRM}]});f.show(),n.alertArr.push(f);try{var l=w.get();p.exceptionInfoCollect({bustype:l.bustype,excode:3,extype:1,exdesc:"银行增量数据ErrorCode:505_token:"+JSON.stringify(l)})}catch(a){}}}});return O})