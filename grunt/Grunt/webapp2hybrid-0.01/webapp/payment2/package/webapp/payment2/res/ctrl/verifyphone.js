define(["libs","c","CommonStore","PayStore","PayModel","PayParentView","verifyphone_html","cUtility","cUIInputClear","cUtilityCrypt","cUICore","Business","paymentPipe","Util","RuleManager","cWidgetFactory","cHybridFacade"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){var g=!1,y=r.PaymentWayStore.getInstance(),b=r.OrderDetailStore.getInstance(),w=r.ExtendInfoStore.getInstance(),E=r.SelectBankStore.getInstance(),S=r.PayMentCardParamStore.getInstance(),x=t.base,T=x.Date,N=new d,C="10106666",k=1,L=w.getAttr("osType"),A=v.create("Guider"),O=s.extend({pageid:"232003",hpageid:"232003",noticeFlag:"pay",verifyControl:null,alertArr:[],tpl:o,refidCode:"",payMethFlag:1,onHide:function(){this.hideLoading(),this.hideWarning404(),this.alertArr.forEach(function(e,t){e&&e.hide&&e.hide()}),c&&c.alertArr.forEach(function(e,t){e&&e.hide&&e.hide()})},onCreate:function(){var e=this;e.verifyControl=p.verifyCodeControl.call(e),this.render()},onShow:function(){this.setHeaderView(),this.setTitle("验证手机")},setHeaderView:function(e){var t=this,e=e||"验证手机",n=t.getHeaderViewOption(e,t)||{};t.headerview.set(n),t.headerview.show(),t.eventRegister()},onLoad:function(e){var t=this,n;k=y.getAttr("seniortype")?y.getAttr("seniortype"):1,k==1?(t.els.c_pay_verifyphone_credit_verify_text.hide(),t.els.c_pay_verifyphone_wallet_verify_text.show(),n=y.getAttr("verifyMobile")):(t.els.c_pay_verifyphone_credit_verify_text.show(),t.els.c_pay_verifyphone_wallet_verify_text.hide(),n=y.getAttr("creditVerifyMobile"));var r=n&&n.toString().replace(/(\d{3})\d{4}(\d{4})/,"$1****$2");t.els.c_pay_verifyphone_i_prePhone.html(r),t.els.c_pay_verifyphone_prephone.val(n),t.els.c_pay_verifyphone_check_code.val(""),t.updatePage()},render:function(){this.$el.html(this.tpl),this.els={c_pay_verifyphone_i_prePhone:this.$el.find("#c_pay_verifyphone_i_prePhone"),c_pay_verifyphone_prephone:this.$el.find("#c_pay_verifyphone_prephone"),c_pay_verifyphone_get_code:this.$el.find("#c_pay_verifyphone_get_code"),c_pay_verifyphone_count_down_clock:this.$el.find("#c_pay_verifyphone_count_down_clock"),c_pay_verifyphone_check_code:this.$el.find("#c_pay_verifyphone_check_code"),c_pay_verifyphone_submit:this.$el.find("#c_pay_verifyphone_submit"),c_pay_verifyphone_li_prePhone:this.$el.find("#c_pay_verifyphone_li_prePhone"),c_pay_verifyphone_wallet_verify_text:this.$el.find(".c_pay_verifyphone_wallet_verify_text"),c_pay_verifyphone_credit_verify_text:this.$el.find(".c_pay_verifyphone_credit_verify_text")}},goBack:function(){var e=this,t=b.getAttr("indexurl"),n=p.geturlQuery("from");n&&n!="index"?e.back("#"+n):e.back(t)},events:{"input #c_payment_cardbin":"showClearBtn","click #c_pay_verifyphone_submit":"verifyPhone","click #c_pay_verifyphone_get_code":"CodeValFn"},updatePage:function(){var e=this,t={};t.title="新增银行卡",e.initHeadView(t);try{e.turning()}catch(n){}},initHeadView:function(e){var t=this,n=t.getHeaderViewOption(e.title,t)||{};this.headerview.set(n),this.headerview.show(),t.eventRegister()},eventRegister:function(){!u.isInApp()||A.register({tagname:m.METHOD_PHONE,callback:function(){A.callPhone({tel:C})}})},getHeaderViewOption:function(e,t){var n={title:e,back:!0,view:t,events:{returnHandler:function(){y.setAttr("cancelWindControl",1),t.goBack()}}};return u.isInApp()?n.phone=!0:n.tel={number:C},n},CodeValFn:function(){var e=this,n=b,r=E.get(),i=e.els.c_pay_verifyphone_prephone.val(),s=S.getAttr("cardInfo")&&S.getAttr("cardInfo"),o=0;if(!i){e.showToast("请填写手机号码",1.2),N.addErrClass(e.els.c_pay_verifyphone_prephone,e.els.c_pay_verifyphone_li_prePhone);return}N.clearErrClass(e.els.c_pay_verifyphone_prephone,e.els.c_pay_verifyphone_li_prePhone);if(k==1)if(s.isPay)o=b.getAttr("totalamount");else{var a=s.cardlist?s.cardlist:{},f=s.walletlist?s.walletlist:{};for(var l=0;l<a.length;l++)o+=a[l].useamoumt;for(var l=0;l<f.length;l++)o+=f[l].useamoumt;o=o?o:b.getAttr("totalamount")}else o=b.getAttr("totalamount");e.verifyControl.showLoading("c_pay_verifyphone_count_down_clock","c_pay_verifyphone_get_code");var p={phone:i,amount:o,seniortype:k},d=c.getRequestHeader(),v=function(n){var r=null;e.els.c_pay_verifyphone_get_code.attr("id","c_pay_verifyphone_get_code"),e.hideLoading();if(!u.isInApp())r=n;else{if(!n.resultBody){e.hideLoading(),e.showToast(n.errorInformation||"网络不给力,请稍候重试"),e.verifyControl.hideLoading("c_pay_verifyphone_count_down_clock","c_pay_verifyphone_get_code");return}r=JSON.parse(n.resultBody)}if(typeof r.res!="undefined"&&r.res){e.hideLoading(),e.showToast("网络不给力,请稍候重试"),e.verifyControl.hideLoading("c_pay_verifyphone_count_down_clock","c_pay_verifyphone_get_code");return}r.result==0?(e.refidCode=r.refid,t.storage.localStorage.set("VALIDATETIMEOUT",(new Date).valueOf(),(new T).addDay(1)),e.els.c_pay_verifyphone_get_code.hide(),e.els.c_pay_verifyphone_count_down_clock.show(),e.verifyControl.runVerifyCode("c_pay_verifyphone_count_down_clock","c_pay_verifyphone_get_code",!0)):(e.refidCode="",e.showToast(r.resultmesg||"提交失败！请稍后再试"),e.verifyControl.hideLoading("c_pay_verifyphone_count_down_clock","c_pay_verifyphone_get_code"))};h.verifyPhoneCode(p,v,JSON.stringify(d),function(t){e.refidCode="",e.hideLoading(),e.showToast(t.msg),e.verifyControl.hideLoading("c_pay_verifyphone_count_down_clock","c_pay_verifyphone_get_code")}),e.els.c_pay_verifyphone_get_code.attr("id","")},verifyPhone:function(){var e=this,t=e.els.c_pay_verifyphone_check_code.val()||"";if(t.length<1){e.showToast("请填写验证码");return}var n={vercode:t,seniortype:k},r=function(n){if(u.isInApp()){if(!n.resultBody){e.hideLoading(),e.showToast(n.errorInformation||"网络不给力,请稍候重试");return}n=JSON.parse(n.resultBody)}if(typeof n.res!="undefined"&&n.res){e.hideLoading(),e.showToast("网络不给力,请稍候重试");return}e.hideLoading(),n.result==0?(y.setAttr("verifiedPhone",1),y.setAttr("vcode",t),k==2&&y.setAttr("verifiedCardNo",y.getAttr("verifyingCardNo")),y.setAttr("autoPay",1),e.goBack()):(e.hideLoading(),e.showToast(n.resultmesg||"网络不给力,请稍候重试"))};e.showLoading();var i=c.getRequestHeader(),s=JSON.stringify(i);h.verifyPhoneNum(n,r,s,function(){e.hideLoading(),e.showToast("网络不给力,请稍候重试")})}});return O})