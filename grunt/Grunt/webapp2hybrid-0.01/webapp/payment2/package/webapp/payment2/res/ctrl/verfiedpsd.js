define(["libs","c","CommonStore","PayStore","PayModel","PayParentView","verfiedpsd_html","cUtility","cWidgetFactory","paymentPipe","cUIInputClear","cUtilityCrypt","cUICore","Business","Util","cUIIdentitycard"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){$.scrollTo||($.scrollTo=function(e){window.scrollTo(0,e.endY-50)});var m=r.OrderDetailStore.getInstance(),g=r.PayMentCardParamStore.getInstance(),y=r.touchPayStore.getInstance(),b=r.PaymentWayStore.getInstance(),w=a.create("Guider"),E=null,S=0,x=s.extend({pageid:"232002",hpageid:"232002",noticeFlag:"pay",alertArr:[],tpl:o,onHide:function(){this.hideLoading(),this.alertArr.forEach(function(e,t){e&&e.hide&&e.hide()}),p&&p.alertArr.forEach(function(e,t){e&&e.hide&&e.hide()}),E&&E.hide()},onCreate:function(){this.render(),this.showVerifedpsdUi()},onShow:function(){this.setHeaderView()},onLoad:function(e){var t=this;t.els.verfiedpsds.removeClass("iconmima"),E&&(E.show(),E.pwdval=[]),S=0;var n=t.$el.find("#c_payment_verfiedpsd_target li.iconmima");n.length!=6&&t.$el.find("#c_payment_submitpay").addClass("btndisabled");try{t.turning()}catch(r){}},render:function(){this.$el.html(this.tpl),this.els={verfiedpsd_target:this.$el.find("#c_payment_verfiedpsd_target"),verfiedpsds:this.$el.find("#c_payment_verfiedpsd_target").children("li")}},events:{"click #c_payment_submitpay":"checkPwd","click #c_payment_verfiedpsd_target":"showverifedpsd","click #c_payment_verfiedpsd_getpwd":"getpwd"},setHeaderView:function(e){var t=this,n=0;t.headerview.set({title:e||"验证支付密码",back:!0,view:t,events:{returnHandler:function(){t.goBack()}}}),t.headerview.show()},getUrlParama:function(){var e="";return m.get()&&(e=m.getAttr("indexurl")),e},goBack:function(){var e=this,t=this.getUrlParama(),n=d.geturlQuery("from");n&&n!="index"?e.back(n):e.back(t)},getpwd:function(){var e=this,t=m.getAttr("from"),n="chgpwd",r=location.href,i={islogin:m.getAttr("isload"),auth:m.getAttr("auth"),time:"2099/01/01 00:00:00",isuser:m.getAttr("isload")},s=encodeURIComponent(c.Base64.encode(JSON.stringify(i))),o={WALLET_AUTH_INFO:s};d.addCookie(o),localStorage.setItem("WALLET_AUTH_INFO",s);var a={from:"",eback:""};if(u.isInApp()){var f=this.getRoot()+"#lipincardpay";a.eback=a.from=f;var l=encodeURIComponent(c.Base64.encode(JSON.stringify(a)));w.cross({path:"wallet",param:"index.html#"+n+"?token="+l})}else{t="https://"+location.host,a.eback=a.from=r;var l=encodeURIComponent(c.Base64.encode(JSON.stringify(a)));this.jump(t+"/webapp/wallet/index.html#"+n+"?token="+l)}},checkPwd:function(e){var n=this,r=E.pwdval,i={},s=$(e.currentTarget);if(s.hasClass("btndisabled"))return;if(!r||r.length<6){n.showToast("请填写支付密码",3,function(){},!0);return}var o=/^[0-9]{6}$/;r=r.join("");if(!o.test(r)){this.showToast("请填写正确的支付密码",3,function(){n.els.verfiedpsds.each(function(e,t){$(t).removeClass("iconmima")}),E.pwdval.length=0,S=0},!0);return}var a=function(e){var i={};i.res=e.res,i.msg=e.msg;if(u.isInApp()){if(!e.resultBody){n.hideLoading(),n.showToast(e.errorInformation||"网络不给力,请稍候重试");return}i=JSON.parse(e.resultBody),i.res=i.Result,i.msg=i.ResultMessage}if(!p.lipinCardExcuteCallback.call(null,e)){n.tktErrorStore.setAttr("tktUsed",1);var s=new t.ui.Alert({title:"提示信息",message:"支付失败，请重新尝试",buttons:[{text:"确定",click:function(){p.removePayCardStore(),p.goHome.call(n)},type:t.ui.Alert.STYLE_CONFIRM}]});s.show(),n.alertArr.push(s);return}i.res?(b.setAttr("checkpwd",c.Base64.encode(r)),b.setAttr("checkJson",i),E.pwdval=null,n.goBack(),n.hideLoading()):(n.hideLoading(),n.showToast(i.msg||"支付密码错误",3,function(){n.els.verfiedpsds.each(function(e,t){$(t).removeClass("iconmima")}),E.pwdval.length=0,S=0;var e=n.$el.find("#c_payment_verfiedpsd_target li.iconmima");e.length!=6&&n.$el.find("#c_payment_submitpay").addClass("btndisabled")},!0))};m&&m.get()&&(i=p.getRequestHeader());var l=JSON.stringify(i);n.showLoading(),f.verifyPassword({pwd:c.Base64.encode(r),ver:1},a,l,function(){n.hideLoading(),n.showToast("网络不给力,请稍候重试",3,function(){},!0)})},showVerifedpsdUi:function(){var e=this;if(!E){var t=e.els.verfiedpsds;E=new v({targetEl:e.els.verfiedpsd_target,itemClickAction:function(n){if(S>5)return;S==5&&e.$el.find("#c_payment_submitpay").removeClass("btndisabled"),t.eq(S).addClass("iconmima"),n=n.toString().replace(/\s*/g,""),E.pwdval.push(n),S++},deleteAction:function(){if(S<1)return;S--,S<6&&e.$el.find("#c_payment_submitpay").addClass("btndisabled"),t.eq(S).removeClass("iconmima"),E.pwdval.splice(S,1)},template:'<div class="cui-hd"><span>完成</span></div><div class="cui-bd"><ul><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>0</li><li class="cui-wrapper-delete" style="width:63.28%"><div class="cui-btn-delete"></div></li></ul></div>'})}E.pwdval=[],E.show()},showverifedpsd:function(e){d.stopEvent(e),E&&E.show()}});return x})