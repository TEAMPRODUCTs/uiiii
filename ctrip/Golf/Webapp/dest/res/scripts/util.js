define([],function(){function a(a){var b=c.call(a);return void 0!==a&&null!==a&&(b==d.OBJECT_OBJECT||b==d.OBJECT_ARRAY?!_.isEmpty(a):!0)}var b={},c=Object.prototype.toString,d=(Array.prototype.slice,b.CONST={OBJECT_DATE:"[object Date]",OBJECT_STRING:"[object String]",OBJECT_OBJECT:"[object Object]",OBJECT_ARRAY:"[object Array]",STORE_DETAIL:"detail",STORE_DETAIL_RETURN_CASH:"detail.return.cash",STORE_BOOKING_CALENDAR:"select.calendar",STORE_BOOKING_STEP1:"booking.step1",STORE_BOOKING_STEP2:"booking.step2",STORE_BOOKING_CHOOSED_RESOURCE:"booking.choosed.resource",STORE_BOOKING_HOTEL:"booking.hotel",STORE_BOOKING_SINGLE:"booking.single",STORE_BOOKING_OPTIONAL:"booking.optional",STORE_BOOKING_GUID:"booking.guid.manager",STORE_BOOKING_TMP_ORDER:"booking.tmp.order",STORE_BOOKING_STEP3:"booking.step3",STORE_ORDER_DETAIL_OPTION:"order.detail.option"}),e=b.int=function(a){return parseInt(a,10)},f={search_list:"vacationslist",detail:"detail",detail_select_calendar:"select.calendar",detail_return_cash:"detail.return.cash",detail_booking_note:"detail.booking.note",detail_visa:"detail.visa",select_calendar:"select.calendar",detail_picture_list:"detail.picture.list",detail_picture_detail:"detail.picture.detail",booking_step1:"booking.step1",booking_step2:"booking.step2",booking_select_hotel:"booking.hotel",booking_select_single:"booking.select.single",booking_select_optional:"booking.select.optional",order:"order",order_route:"order.route",order_detail_list:"order.detail.list",order_detail_list_info:"order.detail.list.info"};b.getPath=function(a,c,d){_.isUndefined(d)&&(d=!0);var e=f[a]||"";return(d?"#":"")+e+b.paramStringify(c)},b.paramStringify=function(a,c){if(!a)return"";_.isUndefined(c)&&(c=!0);var d=_.keys(a),e=d.length,f="";return _.each(d,function(d,g){var h=b.date.stringify(a[d]);_.isUndefined(h)&&(h=""),c&&0==g&&(f+="?"),f+=d+"="+h,g!=e-1&&(f+="&")}),f};var g=/.*?\?(.*)/,h={};b.paramParse=function(a){if(!a){var c=location.hash;if(a=c.substr(1).match(g),a=a&&a[1],!a)return{}}if(!h[a]){var d={};_.each(a.split("&"),function(a){var c=a.match(/([^=]+)=?(.*)/),e=c[2],f=parseFloat(e);f+""==e&&(e=f),e=b.date.parse(e),d[c[1]]=e}),h[a]=d}return h[a]},b.assertError=function(a){var b="[Assertion failed] ";throw b+(a||"")},b.assert=function(a,c){a||b.assertError(c)},b.assertEqual=function(a,c,d){a!=c&&b.assertError(d)},b.assertNotEqual=function(a,c,d){a==c&&b.assertError(d)},b.assertDeepEqual=function(a,c,d){a!==c&&b.assertError(d)},b.assertNotDeepEqual=function(a,c,d){a===c&&b.assertError(d)},b.ensureAll=function(b,c){return b&&_.every(c,function(c){return a(b[c])})},b.ensureSome=function(b,c){return b&&_.some(c,function(c){return a(b[c])})},b.copyJSON=function(a){return JSON.parse(JSON.stringify(a))};var i="_dd",j="dd_";b.date={stringify:function(a,b,e){return b=b||i,e=e||j,c.call(a)==d.OBJECT_DATE?b+a.getTime()+e:a},parse:function(a,c,d){c=c||i,d=d||j;var e=new RegExp("^"+c+"\\d+"+d+"$");return _.isString(a)&&a.match(e)?new Date(b.int(a.substr(c.length,a.length-(c.length+d.length)))):a},transform:function(a){var c=a.match(/^\/Date\((\d+)\+\d+\)\/$/);if(c){var d=b.int(c[1]);return b.calendar.format(new Date(d))}return a}};var k={},l=function(a){this.KEY=a,this.storage=window.localStorage,this.not_store_key="storage_data"};l.prototype._getStore=function(){var a=this.storage.getItem(this.KEY);return a?JSON.parse(a):{}},l.prototype.get=function(a){var c=this._getStore();return _.each(c,function(a,d){c[d]=b.date.parse(a)}),_.isUndefined(a)?c:c[a]},l.prototype.set=function(a,e){var f=this._getStore();if(c.call(a)==d.OBJECT_OBJECT){var g=_.extend(f,a),h=e||[];h.push(this.not_store_key),_.each(h,function(a){delete g[a]}),_.each(g,function(a,c){g[c]=b.date.stringify(a)}),this.storage.setItem(this.KEY,JSON.stringify(g))}else a!=this.not_store_key&&(f[a]=e,this.storage.setItem(this.KEY,JSON.stringify(f)));return this},l.prototype.remove=function(a){var b=this._getStore();return delete b[a],this.storage.setItem(this.KEY,JSON.stringify(b)),this},l.prototype.clear=function(){return this.storage.removeItem(this.KEY),this},b.getStorage=function(a){return k[a]||(k[a]=new l(a)),k[a]},b.memoryCache={_cache:{},get:function(a){return this._cache[a]},set:function(a,b){return this._cache[a]=b,this},remove:function(a){return delete this._cache[a],this}};var m=b.pad=function(a,b,c,d){return a=a.toString(),a.length<b&&(c=new Array(b).join(c||" "),a=d?(c+a).substr(-b):(a+c).substring(0,b)),a};return b.calendar={strToDate:function(a){if(a instanceof Date||!a)return a;var b,c,d,f=a.split("-");return 3==f.length&&(b=e(f[0]))&&(c=e(f[1]))&&(d=e(f[2]))?new Date(b,c-1,d):a},getFullMonth:function(a){return e(a instanceof Date?a.getMonth():a)+1},format:function(a,c){return(a=b.calendar.strToDate(a))?(c=c||"yyyy-mm-dd",a=c.replace(/y+|m+|d+|H+|M+|s+/g,function(b){var c=b.substr(0,1),d=b.length;switch(c){case"y":return a.getFullYear().toString().substr(4-d);case"m":return m(a.getMonth()+1,d,"0",!0);case"d":return m(a.getDate(),d,"0",!0);case"H":return m(a.getHours(),d,"0",!0);case"M":return m(a.getMinutes(),d,"0",!0);case"s":return m(a.getSeconds(),d,"0",!0)}})):a}},b.extendDeep=function(a,e){if(c.call(e)==d.OBJECT_OBJECT){var f={};for(var g in a)f[g]=a[g];for(var h in e)f[h]=b.extendDeep(f[h],e[h]);return f}return e},b.helper={dateFormat:function(a,e){_.isUndefined(e)&&(e=1),c.call(a)==d.OBJECT_DATE&&(a=b.date.stringify(a));var f,g;return 1==e&&(f=a.split("-"),g=f[1]+"月"+f[2]+"日"),g},strdate:function(a){return"string"==typeof a?new Date(Date.parse(a.replace(/-/g,"/"))):a}},b.getEnvCode=function(a){var b=location.host;return a&&a.isInApp()?window.localStorage.getItem("isPreProduction"):b.match(/m\.fat/i)||b.match(/^(localhost|172\.16|127\.0)/i)||b.match(/^(192\.168\.253\.1)/i)?"0":b.match(/^(10\.8)/i)?"1":"2"},b});