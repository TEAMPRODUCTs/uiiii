define(["libs","c","cBasePageView","cWidgetFactory","GolfModel","GolfStore","CommonStore","text!templates/leaderboard.html","res/scripts/leaderboard_helper"],function(a,b,c,d,e,f,g,h,i){var j=(d.create("Guider"),g.UserStore.getInstance().getUserId(),e.LeaderBoardModel.getInstance());return c.extend({pageid:"275010",hpageid:"276010",render:function(){this.$el.append(h),this.els={detail_header_template:this.$el.find("#detail_header_template").html(),detail_header:this.$el.find("#detail_header"),player_name_template:this.$el.find("#player_name_template").html(),player_name:this.$el.find("#player_name"),player_score_total_template:this.$el.find("#player_score_total_template").html(),player_score_total:this.$el.find("#player_score_total"),player_score_details_template:this.$el.find("#player_score_details_template").html(),player_score_details:this.$el.find("#player_score_details")}},onCreate:function(){var a=this.getQuery("game_id"),b=this.getQuery("passcode")||"";a?j.setGameAccessCode(a,b):this.showToast("参数错误:缺失game_id"),this.injectHeaderView(),this.render()},events:{"click .icon_data":"switchToSummary","click .GoBack":"switchToSummary"},switchToSummary:function(){b.utility.isInApp()&&IWanUtil.app_rotate_screen("Portrait"),this.back()},onLoad:function(){var a=this;b.utility.isInApp()&&IWanUtil.app_rotate_screen("Landscape"),a.setHeader(),a.showLoading(),j.load(function(b){a.hideLoading(),a.processResponse(b),a.showView(b),a.turning()},function(b){a.hideLoading(),a.showToast(b),a.switchToSummary()})},processResponse:function(a){j.endOfGame=3==a.gameStatus;var b=a.courseFairwayList.length;for(var c in a.playerScoreCard){for(var d=a.playerScoreCard[c],e=d.scoreCardDetailList,f=[],g=0;b>g;g++){var h=!1;for(var i in e){var k=e[i];if(g==k.sort-1){f[g]={totalScore:k.totalScore,handicap:k.handicap},h=!0;break}}h||(f[g]={totalScore:null,handicap:null})}d.scoreCardDetailListAll=f}},setHeader:function(){b.utility.isInApp()&&this.headerview.hideHandler()},showView:function(a){this.els.detail_header.html(_.template(this.els.detail_header_template)({model:a,helper:i})),this.showScore(a)},showScore:function(a){this.els.player_name.html(_.template(this.els.player_name_template)({model:a,helper:i})),this.els.player_score_total.html(_.template(this.els.player_score_total_template)({model:a,helper:i})),this.els.player_score_details.html(_.template(this.els.player_score_details_template)({model:a,helper:i}))},onShow:function(){var a=this;a.intervalId||j.endOfGame||(a.intervalId=setInterval(function(){a.refreshScore()},i.refreshIntervel))},onHide:function(){this.intervalId||(clearInterval(this.intervalId),delete this.intervalId)},refreshScore:function(){var a=this;j.refresh(function(b,c){c&&(a.processResponse(b),a.showScore(b))})}})});