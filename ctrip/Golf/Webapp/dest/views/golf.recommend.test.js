define(["text!templates/golf.recommend.html"],function(a){"use strict";var b={recommendCode:"6sv6j",award:100,username:"user",recommendByCode:"",canRecommendCoe:1},c=Backbone.View.extend({el:$("#main"),initialize:function(){this.render(b)},initTemplate:function(){return _.template(a)},render:function(a){var b=this.initTemplate();this.$el.html(b({data:a})),this.elsBox={recommend_text_tpl:this.$el.find("#recommend_text_tpl")},this.initShareData()},getEmailTxtMsg:function(a){var b=" 邀请您的朋友一起打高尔夫！点击链接 <%= data.downloadLink %> 下载爱玩高尔夫，注册并绑定手机成功后，进入个人中心->设置->推荐爱玩高尔夫，输入我的推荐码                    <%= data.recommendCode %>,  您的朋友就能立即获得<%= data.award %>元抵用余额.",c=_.template(b);return c({data:a})},onCreate:function(){this.injectHeaderView()},events:{"click #friends_share":"friendsShare","click #weixin_share":"weixinShare","click #email_share":"emailShare","click #message_share":"messageShare","click #recommend_confirm":"recommend"},onLoad:function(){var a=this;this.headerview.set({title:"推荐爱玩高尔夫",back:!0,view:this,btn:{title:"推荐记录",id:"recomdHisBtn",classname:"header_r"},events:{returnHandler:function(){var b=a.getQuery("from");if("nopage"==b)isInApp?Guider.backToLastPage({}):a.back();else if(/\/webapp\/(\S+)\/(\S+)/.test(b)){var c=b.match(/\/webapp\/(\S+)\/(\S+)/);isInApp?Guider.cross({path:c[1],param:c[2]}):window.location=c[0]}else this.back(b||"#index")}},commit:{id:"recomdHisBtn",callback:function(){a.forward("#golf.recommend.users")}}}),$("title").html("推荐爱玩高尔夫"),this.headerview.show();var c=IsNonUserLogin();if(!(userStore&&userStore.isLogin()||c)){var d=location.pathname;return void Member.memberLogin({param:"from="+d+"#golf.recommend",callback:function(){window.location.reload()}})}b={recommendCode:user.recommendCode,award:100,username:user.UserName,recommendByCode:user.recommendByCode,canRecommendCoe:user.canRecommendCoe},this.render(b),this.turning()},onShow:function(){},initShareData:function(){var a={};a.title="邀请朋友一起打高尔夫啦！";var c=encodeURIComponent(JSON.stringify(b));b.downloadLink="http://m.ctrip.com/webapp/golf/index.html#golf.recommend.landing?param="+c,a.text=this.getEmailTxtMsg(b),a.linkUrl="http://m.ctrip.com/webapp/golf/index.html#golf.recommend.landing?param="+c,a.isIOSSystemShare=!1},recommend:function(a){var c=this,d=($(a.currentTarget),$("#recommend_code").val());return d?(c.recommendModel.param={token:headInfo&&headInfo.auth?headInfo.auth:"",recommendCode:d},c.showLoading(),void c.recommendModel.execute(function(a){0==a.code?(user.recommendByCode=c.recommendModel.param.recommendCode,b={recommendCode:user.recommendCode,award:100,recommendByCode:user.recommendByCode,canRecommendCoe:user.canRecommendCoe},IWanUtil.app_call_recommendByCode_update(user.recommendByCode),c.render(b),c.showToast("保存推荐码成功！"),c.hideLoading()):(c.showToast(a.message),c.hideLoading())})):void c.showToast("请输入推荐码！")},onHide:function(){}});return 0,c});