define(["libs","c","cBasePageView","GolfModel","GolfStore","CommonStore","text!templates/golf.order.sback.html","cWidgetFactory","cWidgetGuider"],function(a,b,c,d,e,f,g,h){var i=e.OrderParamStore.getInstance(),j=d.SubmitOrderModel.getInstance(),k=f.HeadStore.getInstance(),l=k.get(),m=b.utility.isInApp(),n=h.create("Guider"),o=e.BookingConfirmParam.getInstance(),p=e.BookingConfirmTemp.getInstance(),q=f.UserStore.getInstance();p.setURLParamsToStore();var r=c.extend({pageid:"275006",hpageid:"276006",render:function(a){this.$el.html(a)},onCreate:function(){this.injectHeaderView(),this.render()},events:{"click .ticket_borderbox":"toDetail","click .try_again":"tryAgain","click .back_to_home_box":"backToHome"},onLoad:function(){this.getData(),q.isLogin()&&this.submit(function(a){this.render(_.template(g)(a))}),this.turning()},tryAgain:function(){this.onLoad()},getData:function(){var a=p.get(),b={};b.tempoid=a.orderid,b.payinfo={paytype:4==a.paytype?1:0,paymode:1,extno:a.externalno,billno:a.billno},o.setParam(b)},getQueryString:function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i");if(window.location.hash.split("?").length>1){var c=window.location.hash.split("?")[1].match(b);return null!=c?unescape(c[2]):null}return null},goThrid:function(a){var b,c,d,e,f=[];a=JSON.parse(a),b="/webapp/golf/#golf.order.sback?ordID="+a.orderNo,c="/webapp/golf/#order.detail?oid="+a.orderNo,d=m?"":"http://"+location.host,b=encodeURIComponent(d+b),c=encodeURIComponent(d+c);var g=p.get(),h=o.get(),i={saveID:g.saveid,orderID:a.orderNo,billNo:h.payinfo.billno,externalNo:h.payinfo.extno,errorCode:"",auth:l.auth,tsBack:b,tpBack:c};for(var j in i)f.push(j+"="+i[j]);if(e=f.join("&"),e.indexOf("?")<0&&(e="?"+e),m){g.backurl=g.backurl.replace("file:///webapp/","");var k=g.backurl.split("/");return void n.cross({path:k[0],param:k[1]+e})}window.location.href=g.backurl+e},goSelf:function(a,b){a.call(this,JSON.parse(b))},submit:function(a){var b=this,c=i.get(),d=this.getQueryString("ordID"),e=this.getQueryString("payType"),f=4==e?1:0;return d?c&&c.forder&&c.forder.orderNo==d?(this.orderid=c.forder.orderNo,b.headerReset(),void a.call(this,c.forder)):(b.showLoading(),j.setParameter(l.auth,parseInt(d),f),void j.execute(function(c){b.hideLoading();var d=o.get();if(c.orderNo){if(b.orderid=c.orderNo,c=JSON.stringify(c),i.setAttr("forder",$.extend(c,{orderNo:b.orderid})),1==d.payinfo.paytype)return void b.goThrid(c);b.headerReset(),b.goSelf(a,c)}else b.showToast(c.message||"出错",3,function(){IWanUtil.app_goto_order()})},function(){b.hideLoading(),b.headerview.set({title:"订单失败",back:!0,home:!0,view:this,events:{returnHandler:function(){IWanUtil.app_back_to_home()},homeHandler:function(){IWanUtil.app_back_to_home()}}}),b.headerview.show(),i.setAttr("forder",$.extend({},{orderNo:""})),a.call(b,i.get().forder)},!1,this)):void this.showToast("数据出错")},headerReset:function(){var a=this;a.headerview.reset({title:"订单完成",back:!0,home:!0,view:this,events:{returnHandler:function(){IWanUtil.app_back_to_home()},homeHandler:function(){IWanUtil.app_back_to_home()}}}),a.headerview.show()},toDetail:function(){IWanUtil.app_goto_order_detail(this.orderid)},backToHome:function(){IWanUtil.app_back_to_home()},onShow:function(){},onHide:function(){}});return r});