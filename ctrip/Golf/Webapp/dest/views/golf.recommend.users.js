define(["libs","c","cBasePageView","GolfModel","GolfStore","CommonStore","text!templates/golf.recommend.users.html","cUtilityCrypt","cWidgetFactory","cWidgetGuider","cWidgetMember"],function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n=f.UserStore.getInstance(),o=(n.getUser(),f.HeadStore.getInstance()),p=o.get(),q=(b.utility.isInApp(),100),r=0,s=c.extend({recommendUsersModel:d.RecommendUsersModel.getInstance(),pageid:"",hpageid:"",initTemplate:function(){return _.template(g)},render:function(a){var b=this.initTemplate();this.$el.html(b({data:a}))},onCreate:function(){this.injectHeaderView()},events:{"click .try_again":"tryAgain"},onShow:function(){},onLoad:function(){var a=this;i=this.$el.find(".base_loading"),this.headerview.set({title:"推荐记录",back:!0,view:this,events:{returnHandler:function(){this.back()}}}),k=function(){a.onWindowScroll(a)},this.headerview.show(),this.getRecommendUsers(),this.turning()},getRecommendUsers:function(){var a=this;a.recommendUsersModel.param={token:p&&p.auth?p.auth:"10020030001",pagerOffset:0,pagerPerPage:q,sortType:"D",sortDirection:"ASC"},a.showLoading(),a.recommendUsersModel.execute(function(b){j=b,$(window).bind("scroll",k),a.render(b),h=b.recommendUsers&&b.recommendUsers&&b.recommendUsers.length==q?0:2,a.hideLoading()},function(){a.hideLoading(),$(".wireless_failure").show()})},tryAgain:function(){this.onLoad()},onWindowScroll:function(a){function b(){var b=$("#headerview")[0].clientHeight+$(".recommend_users_ul")[0].clientHeight;l+$(window).height()>b&&(0,!h&&j.recommendUsers&&a.addmore())}!j.recommendUsers||i.height()||h||i.show(),2==h?($(window).unbind("scroll",k),!!j.recommendUsers&&$(".no_more").show()):(l=document.documentElement.scrollTop||document.body.scrollTop,clearTimeout(m),m=setTimeout(b,300))},addmore:function(){r+=q;var a=this;a.recommendUsersModel.param={token:p&&p.auth?p.auth:"10020030001",pagerOffset:r/q,pagerPerPage:q,sortType:"D",sortDirection:"ASC"},a.showLoading(),a.recommendUsersModel.execute(function(b){if(b.recommendUsers&&b.recommendUsers){var c='<%_.each(data.recommendUsers, function(v,k){%>                            <li>                            <span><span class="name"><%=v.userName%></span>                            <%if(!!v.play){%>                            <span class="experienced">已体验</span></span>                            <span class="price_amount">+<%=v.amount%></span>                            <%}%>                            </li>                            <%})%>',d=_.template(c),e=$(d({data:b}));a.$el.find(".recommend_users_ul").append(e),j.recommendUsers=(j.recommendUsers&&j.recommendUsers.length?j.recommendUsers:[]).concat(b.recommendUsers),b.recommendUsers.length==q?h=0:(h=2,$(".no_more").show()),a.hideLoading()}else h=2,a.hideLoading(),$(".no_more").show()},function(){h=2,a.hideLoading(),$(".no_more").show()})},onHide:function(){}});return s});