define(["libs","c","cBasePageView","GolfModel","GolfStore","CommonStore","text!templates/golf.recommend.html","cUtilityCrypt","cWidgetFactory","cWidgetGuider","cWidgetMember"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=f.UserStore.getInstance(),k=j.getUser(),l=f.HeadStore.getInstance(),m=l.get(),n={},o=b.utility.isInApp(),p={recommendCode:"6sv6j",award:100,username:"user",recommendByCode:"",canRecommendCoe:1},q=function(){var a=j.getUser();return!!a&&!!a.Auth&&a.IsNonUser},r=i.create("Guider"),s=i.create("Member"),t=c.extend({recommendModel:d.RecommendModel.getInstance(),pageid:"275007",hpageid:"276007",initTemplate:function(){return _.template(g)},render:function(a){var b=this.initTemplate();this.$el.html(b({data:a})),this.elsBox={recommend_text_tpl:this.$el.find("#recommend_text_tpl")},this.initShareData()},getEmailTxtMsg:function(a){var b=" 邀请您的朋友一起打高尔夫！点击链接 <%= data.downloadLink %> 下载爱玩高尔夫，注册并绑定手机成功后，进入个人中心->设置->推荐爱玩高尔夫，输入我的推荐码                    <%= data.recommendCode %>,  您的朋友就能立即获得<%= data.award %>元抵用余额.",c=_.template(b);return c({data:a})},onCreate:function(){this.injectHeaderView()},events:{"click #friends_share":"friendsShare","click #weixin_share":"weixinShare","click #email_share":"emailShare","click #message_share":"messageShare","click #recommend_confirm":"recommend"},onLoad:function(){var a=this;this.headerview.set({title:"推荐爱玩高尔夫",back:!0,view:this,btn:{title:"推荐记录",id:"recomdHisBtn",classname:"header_r"},events:{returnHandler:function(){var b=a.getQuery("from");if("nopage"==b)o?r.backToLastPage({}):a.back();else if(/\/webapp\/(\S+)\/(\S+)/.test(b)){var c=b.match(/\/webapp\/(\S+)\/(\S+)/);o?r.cross({path:c[1],param:c[2]}):window.location=c[0]}else this.back(b||"#index")}},commit:{id:"recomdHisBtn",callback:function(){a.forward("#golf.recommend.users")}}}),$("title").html("推荐爱玩高尔夫"),this.headerview.show();var b=q();if(!(j&&j.isLogin()||b)){var c=location.pathname;return void s.memberLogin({param:"from="+c+"#golf.recommend",callback:function(){window.location.reload()}})}p={recommendCode:k.recommendCode,award:100,username:k.UserName,recommendByCode:k.recommendByCode,canRecommendCoe:k.canRecommendCoe},this.render(p),this.turning()},onShow:function(){},initShareData:function(){n.title="邀请朋友一起打高尔夫啦！";var a=encodeURIComponent(JSON.stringify(p));p.downloadLink="http://m.ctrip.com/webapp/golf/index.html#golf.recommend.landing?param="+a,n.text=this.getEmailTxtMsg(p),n.linkUrl="http://m.ctrip.com/webapp/golf/index.html#golf.recommend.landing?param="+a,n.isIOSSystemShare=!1},weixinShare:function(){IWanUtil.app_call_weixin_share(n.title,n.text,n.linkUrl,null,n.isIOSSystemShare)},friendsShare:function(){IWanUtil.app_call_friends_share(n.title,n.text,n.linkUrl,null,n.isIOSSystemShare)},emailShare:function(){IWanUtil.app_call_email_share(n.title,n.text,n.linkUrl,null,n.isIOSSystemShare)},messageShare:function(){IWanUtil.app_call_message_share(n.title,n.text,n.linkUrl,null,n.isIOSSystemShare)},recommend:function(a){var b=this,c=($(a.currentTarget),$("#recommend_code").val());return c?(b.recommendModel.param={token:m&&m.auth?m.auth:"",recommendCode:c},b.showLoading(),void b.recommendModel.execute(function(a){0==a.code?(k.recommendByCode=b.recommendModel.param.recommendCode,p={recommendCode:k.recommendCode,award:100,recommendByCode:k.recommendByCode,canRecommendCoe:k.canRecommendCoe},IWanUtil.app_call_recommendByCode_update(k.recommendByCode),b.render(p),b.showToast("保存推荐码成功！"),b.hideLoading()):(b.showToast(a.message),b.hideLoading())})):void b.showToast("请输入推荐码！")},onHide:function(){}});return t});